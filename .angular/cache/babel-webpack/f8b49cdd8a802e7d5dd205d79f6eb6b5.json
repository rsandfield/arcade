{"ast":null,"code":"import { Observable } from \"./observable\";\nimport { DomManagement } from \"./domManagement\";\nimport { Logger } from \"./logger\";\nimport { DeepCopier } from \"./deepCopier\";\nimport { PrecisionDate } from \"./precisionDate\";\nimport { _DevTools } from \"./devTools\";\nimport { WebRequest } from \"./webRequest\";\nimport { EngineStore } from \"../Engines/engineStore\";\nimport { FileTools } from \"./fileTools\";\nimport { PromisePolyfill } from \"./promise\";\nimport { TimingTools } from \"./timingTools\";\nimport { InstantiationTools } from \"./instantiationTools\";\nimport { GUID } from \"./guid\";\n/**\r\n * Class containing a set of static utilities functions\r\n */\n\nvar Tools =\n/** @class */\nfunction () {\n  function Tools() {}\n\n  Object.defineProperty(Tools, \"BaseUrl\", {\n    /**\r\n     * Gets or sets the base URL to use to load assets\r\n     */\n    get: function () {\n      return FileTools.BaseUrl;\n    },\n    set: function (value) {\n      FileTools.BaseUrl = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"DefaultRetryStrategy\", {\n    /**\r\n     * Gets or sets the retry strategy to apply when an error happens while loading an asset\r\n     */\n    get: function () {\n      return FileTools.DefaultRetryStrategy;\n    },\n    set: function (strategy) {\n      FileTools.DefaultRetryStrategy = strategy;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"CorsBehavior\", {\n    /**\r\n     * Default behaviour for cors in the application.\r\n     * It can be a string if the expected behavior is identical in the entire app.\r\n     * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\r\n     */\n    get: function () {\n      return FileTools.CorsBehavior;\n    },\n    set: function (value) {\n      FileTools.CorsBehavior = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"UseFallbackTexture\", {\n    /**\r\n     * Gets or sets a global variable indicating if fallback texture must be used when a texture cannot be loaded\r\n     * @ignorenaming\r\n     */\n    get: function () {\n      return EngineStore.UseFallbackTexture;\n    },\n    set: function (value) {\n      EngineStore.UseFallbackTexture = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"RegisteredExternalClasses\", {\n    /**\r\n     * Use this object to register external classes like custom textures or material\r\n     * to allow the laoders to instantiate them\r\n     */\n    get: function () {\n      return InstantiationTools.RegisteredExternalClasses;\n    },\n    set: function (classes) {\n      InstantiationTools.RegisteredExternalClasses = classes;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"fallbackTexture\", {\n    /**\r\n     * Texture content used if a texture cannot loaded\r\n     * @ignorenaming\r\n     */\n    get: function () {\n      return EngineStore.FallbackTexture;\n    },\n    set: function (value) {\n      EngineStore.FallbackTexture = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Read the content of a byte array at a specified coordinates (taking in account wrapping)\r\n   * @param u defines the coordinate on X axis\r\n   * @param v defines the coordinate on Y axis\r\n   * @param width defines the width of the source data\r\n   * @param height defines the height of the source data\r\n   * @param pixels defines the source byte array\r\n   * @param color defines the output color\r\n   */\n\n  Tools.FetchToRef = function (u, v, width, height, pixels, color) {\n    var wrappedU = Math.abs(u) * width % width | 0;\n    var wrappedV = Math.abs(v) * height % height | 0;\n    var position = (wrappedU + wrappedV * width) * 4;\n    color.r = pixels[position] / 255;\n    color.g = pixels[position + 1] / 255;\n    color.b = pixels[position + 2] / 255;\n    color.a = pixels[position + 3] / 255;\n  };\n  /**\r\n   * Interpolates between a and b via alpha\r\n   * @param a The lower value (returned when alpha = 0)\r\n   * @param b The upper value (returned when alpha = 1)\r\n   * @param alpha The interpolation-factor\r\n   * @return The mixed value\r\n   */\n\n\n  Tools.Mix = function (a, b, alpha) {\n    return a * (1 - alpha) + b * alpha;\n  };\n  /**\r\n   * Tries to instantiate a new object from a given class name\r\n   * @param className defines the class name to instantiate\r\n   * @returns the new object or null if the system was not able to do the instantiation\r\n   */\n\n\n  Tools.Instantiate = function (className) {\n    return InstantiationTools.Instantiate(className);\n  };\n  /**\r\n   * Provides a slice function that will work even on IE\r\n   * @param data defines the array to slice\r\n   * @param start defines the start of the data (optional)\r\n   * @param end defines the end of the data (optional)\r\n   * @returns the new sliced array\r\n   */\n\n\n  Tools.Slice = function (data, start, end) {\n    if (data.slice) {\n      return data.slice(start, end);\n    }\n\n    return Array.prototype.slice.call(data, start, end);\n  };\n  /**\r\n   * Provides a slice function that will work even on IE\r\n   * The difference between this and Slice is that this will force-convert to array\r\n   * @param data defines the array to slice\r\n   * @param start defines the start of the data (optional)\r\n   * @param end defines the end of the data (optional)\r\n   * @returns the new sliced array\r\n   */\n\n\n  Tools.SliceToArray = function (data, start, end) {\n    if (Array.isArray(data)) {\n      return data.slice(start, end);\n    }\n\n    return Array.prototype.slice.call(data, start, end);\n  };\n  /**\r\n   * Polyfill for setImmediate\r\n   * @param action defines the action to execute after the current execution block\r\n   */\n\n\n  Tools.SetImmediate = function (action) {\n    TimingTools.SetImmediate(action);\n  };\n  /**\r\n   * Function indicating if a number is an exponent of 2\r\n   * @param value defines the value to test\r\n   * @returns true if the value is an exponent of 2\r\n   */\n\n\n  Tools.IsExponentOfTwo = function (value) {\n    var count = 1;\n\n    do {\n      count *= 2;\n    } while (count < value);\n\n    return count === value;\n  };\n  /**\r\n   * Returns the nearest 32-bit single precision float representation of a Number\r\n   * @param value A Number.  If the parameter is of a different type, it will get converted\r\n   * to a number or to NaN if it cannot be converted\r\n   * @returns number\r\n   */\n\n\n  Tools.FloatRound = function (value) {\n    if (Math.fround) {\n      return Math.fround(value);\n    }\n\n    return Tools._tmpFloatArray[0] = value;\n  };\n  /**\r\n   * Extracts the filename from a path\r\n   * @param path defines the path to use\r\n   * @returns the filename\r\n   */\n\n\n  Tools.GetFilename = function (path) {\n    var index = path.lastIndexOf(\"/\");\n\n    if (index < 0) {\n      return path;\n    }\n\n    return path.substring(index + 1);\n  };\n  /**\r\n   * Extracts the \"folder\" part of a path (everything before the filename).\r\n   * @param uri The URI to extract the info from\r\n   * @param returnUnchangedIfNoSlash Do not touch the URI if no slashes are present\r\n   * @returns The \"folder\" part of the path\r\n   */\n\n\n  Tools.GetFolderPath = function (uri, returnUnchangedIfNoSlash) {\n    if (returnUnchangedIfNoSlash === void 0) {\n      returnUnchangedIfNoSlash = false;\n    }\n\n    var index = uri.lastIndexOf(\"/\");\n\n    if (index < 0) {\n      if (returnUnchangedIfNoSlash) {\n        return uri;\n      }\n\n      return \"\";\n    }\n\n    return uri.substring(0, index + 1);\n  };\n  /**\r\n   * Convert an angle in radians to degrees\r\n   * @param angle defines the angle to convert\r\n   * @returns the angle in degrees\r\n   */\n\n\n  Tools.ToDegrees = function (angle) {\n    return angle * 180 / Math.PI;\n  };\n  /**\r\n   * Convert an angle in degrees to radians\r\n   * @param angle defines the angle to convert\r\n   * @returns the angle in radians\r\n   */\n\n\n  Tools.ToRadians = function (angle) {\n    return angle * Math.PI / 180;\n  };\n  /**\r\n   * Returns an array if obj is not an array\r\n   * @param obj defines the object to evaluate as an array\r\n   * @param allowsNullUndefined defines a boolean indicating if obj is allowed to be null or undefined\r\n   * @returns either obj directly if obj is an array or a new array containing obj\r\n   */\n\n\n  Tools.MakeArray = function (obj, allowsNullUndefined) {\n    if (allowsNullUndefined !== true && (obj === undefined || obj == null)) {\n      return null;\n    }\n\n    return Array.isArray(obj) ? obj : [obj];\n  };\n  /**\r\n   * Gets the pointer prefix to use\r\n   * @param engine defines the engine we are finding the prefix for\r\n   * @returns \"pointer\" if touch is enabled. Else returns \"mouse\"\r\n   */\n\n\n  Tools.GetPointerPrefix = function (engine) {\n    var eventPrefix = \"pointer\"; // Check if pointer events are supported\n\n    if (DomManagement.IsWindowObjectExist() && !window.PointerEvent && DomManagement.IsNavigatorAvailable() && !navigator.pointerEnabled) {\n      eventPrefix = \"mouse\";\n    } // Special Fallback MacOS Safari...\n\n\n    if (engine._badDesktopOS && !engine._badOS && // And not ipad pros who claim to be macs...\n    !(document && \"ontouchend\" in document)) {\n      eventPrefix = \"mouse\";\n    }\n\n    return eventPrefix;\n  };\n  /**\r\n   * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\r\n   * @param url define the url we are trying\r\n   * @param element define the dom element where to configure the cors policy\r\n   */\n\n\n  Tools.SetCorsBehavior = function (url, element) {\n    FileTools.SetCorsBehavior(url, element);\n  }; // External files\n\n  /**\r\n   * Removes unwanted characters from an url\r\n   * @param url defines the url to clean\r\n   * @returns the cleaned url\r\n   */\n\n\n  Tools.CleanUrl = function (url) {\n    url = url.replace(/#/gm, \"%23\");\n    return url;\n  };\n\n  Object.defineProperty(Tools, \"PreprocessUrl\", {\n    /**\r\n     * Gets or sets a function used to pre-process url before using them to load assets\r\n     */\n    get: function () {\n      return FileTools.PreprocessUrl;\n    },\n    set: function (processor) {\n      FileTools.PreprocessUrl = processor;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Loads an image as an HTMLImageElement.\r\n   * @param input url string, ArrayBuffer, or Blob to load\r\n   * @param onLoad callback called when the image successfully loads\r\n   * @param onError callback called when the image fails to load\r\n   * @param offlineProvider offline provider for caching\r\n   * @param mimeType optional mime type\r\n   * @returns the HTMLImageElement of the loaded image\r\n   */\n\n  Tools.LoadImage = function (input, onLoad, onError, offlineProvider, mimeType) {\n    return FileTools.LoadImage(input, onLoad, onError, offlineProvider, mimeType);\n  };\n  /**\r\n   * Loads a file from a url\r\n   * @param url url string, ArrayBuffer, or Blob to load\r\n   * @param onSuccess callback called when the file successfully loads\r\n   * @param onProgress callback called while file is loading (if the server supports this mode)\r\n   * @param offlineProvider defines the offline provider for caching\r\n   * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n   * @param onError callback called when the file fails to load\r\n   * @returns a file request object\r\n   */\n\n\n  Tools.LoadFile = function (url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError) {\n    return FileTools.LoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\n  };\n  /**\r\n   * Loads a file from a url\r\n   * @param url the file url to load\r\n   * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n   * @returns a promise containing an ArrayBuffer corresponding to the loaded file\r\n   */\n\n\n  Tools.LoadFileAsync = function (url, useArrayBuffer) {\n    if (useArrayBuffer === void 0) {\n      useArrayBuffer = true;\n    }\n\n    return new Promise(function (resolve, reject) {\n      FileTools.LoadFile(url, function (data) {\n        resolve(data);\n      }, undefined, undefined, useArrayBuffer, function (request, exception) {\n        reject(exception);\n      });\n    });\n  };\n  /**\r\n   * Load a script (identified by an url). When the url returns, the\r\n   * content of this file is added into a new script element, attached to the DOM (body element)\r\n   * @param scriptUrl defines the url of the script to laod\r\n   * @param onSuccess defines the callback called when the script is loaded\r\n   * @param onError defines the callback to call if an error occurs\r\n   * @param scriptId defines the id of the script element\r\n   */\n\n\n  Tools.LoadScript = function (scriptUrl, onSuccess, onError, scriptId) {\n    if (!DomManagement.IsWindowObjectExist()) {\n      return;\n    }\n\n    var head = document.getElementsByTagName(\"head\")[0];\n    var script = document.createElement(\"script\");\n    script.setAttribute(\"type\", \"text/javascript\");\n    script.setAttribute(\"src\", scriptUrl);\n\n    if (scriptId) {\n      script.id = scriptId;\n    }\n\n    script.onload = function () {\n      if (onSuccess) {\n        onSuccess();\n      }\n    };\n\n    script.onerror = function (e) {\n      if (onError) {\n        onError(\"Unable to load script '\" + scriptUrl + \"'\", e);\n      }\n    };\n\n    head.appendChild(script);\n  };\n  /**\r\n   * Load an asynchronous script (identified by an url). When the url returns, the\r\n   * content of this file is added into a new script element, attached to the DOM (body element)\r\n   * @param scriptUrl defines the url of the script to laod\r\n   * @param scriptId defines the id of the script element\r\n   * @returns a promise request object\r\n   */\n\n\n  Tools.LoadScriptAsync = function (scriptUrl, scriptId) {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      _this.LoadScript(scriptUrl, function () {\n        resolve();\n      }, function (message, exception) {\n        reject(exception);\n      });\n    });\n  };\n  /**\r\n   * Loads a file from a blob\r\n   * @param fileToLoad defines the blob to use\r\n   * @param callback defines the callback to call when data is loaded\r\n   * @param progressCallback defines the callback to call during loading process\r\n   * @returns a file request object\r\n   */\n\n\n  Tools.ReadFileAsDataURL = function (fileToLoad, callback, progressCallback) {\n    var reader = new FileReader();\n    var request = {\n      onCompleteObservable: new Observable(),\n      abort: function () {\n        return reader.abort();\n      }\n    };\n\n    reader.onloadend = function (e) {\n      request.onCompleteObservable.notifyObservers(request);\n    };\n\n    reader.onload = function (e) {\n      //target doesn't have result from ts 1.3\n      callback(e.target[\"result\"]);\n    };\n\n    reader.onprogress = progressCallback;\n    reader.readAsDataURL(fileToLoad);\n    return request;\n  };\n  /**\r\n   * Reads a file from a File object\r\n   * @param file defines the file to load\r\n   * @param onSuccess defines the callback to call when data is loaded\r\n   * @param onProgress defines the callback to call during loading process\r\n   * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\r\n   * @param onError defines the callback to call when an error occurs\r\n   * @returns a file request object\r\n   */\n\n\n  Tools.ReadFile = function (file, onSuccess, onProgress, useArrayBuffer, onError) {\n    return FileTools.ReadFile(file, onSuccess, onProgress, useArrayBuffer, onError);\n  };\n  /**\r\n   * Creates a data url from a given string content\r\n   * @param content defines the content to convert\r\n   * @returns the new data url link\r\n   */\n\n\n  Tools.FileAsURL = function (content) {\n    var fileBlob = new Blob([content]);\n    var url = window.URL || window.webkitURL;\n    var link = url.createObjectURL(fileBlob);\n    return link;\n  };\n  /**\r\n   * Format the given number to a specific decimal format\r\n   * @param value defines the number to format\r\n   * @param decimals defines the number of decimals to use\r\n   * @returns the formatted string\r\n   */\n\n\n  Tools.Format = function (value, decimals) {\n    if (decimals === void 0) {\n      decimals = 2;\n    }\n\n    return value.toFixed(decimals);\n  };\n  /**\r\n   * Tries to copy an object by duplicating every property\r\n   * @param source defines the source object\r\n   * @param destination defines the target object\r\n   * @param doNotCopyList defines a list of properties to avoid\r\n   * @param mustCopyList defines a list of properties to copy (even if they start with _)\r\n   */\n\n\n  Tools.DeepCopy = function (source, destination, doNotCopyList, mustCopyList) {\n    DeepCopier.DeepCopy(source, destination, doNotCopyList, mustCopyList);\n  };\n  /**\r\n   * Gets a boolean indicating if the given object has no own property\r\n   * @param obj defines the object to test\r\n   * @returns true if object has no own property\r\n   */\n\n\n  Tools.IsEmpty = function (obj) {\n    for (var i in obj) {\n      if (obj.hasOwnProperty(i)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n  /**\r\n   * Function used to register events at window level\r\n   * @param windowElement defines the Window object to use\r\n   * @param events defines the events to register\r\n   */\n\n\n  Tools.RegisterTopRootEvents = function (windowElement, events) {\n    for (var index = 0; index < events.length; index++) {\n      var event = events[index];\n      windowElement.addEventListener(event.name, event.handler, false);\n\n      try {\n        if (window.parent) {\n          window.parent.addEventListener(event.name, event.handler, false);\n        }\n      } catch (e) {// Silently fails...\n      }\n    }\n  };\n  /**\r\n   * Function used to unregister events from window level\r\n   * @param windowElement defines the Window object to use\r\n   * @param events defines the events to unregister\r\n   */\n\n\n  Tools.UnregisterTopRootEvents = function (windowElement, events) {\n    for (var index = 0; index < events.length; index++) {\n      var event = events[index];\n      windowElement.removeEventListener(event.name, event.handler);\n\n      try {\n        if (windowElement.parent) {\n          windowElement.parent.removeEventListener(event.name, event.handler);\n        }\n      } catch (e) {// Silently fails...\n      }\n    }\n  };\n  /**\r\n   * Dumps the current bound framebuffer\r\n   * @param width defines the rendering width\r\n   * @param height defines the rendering height\r\n   * @param engine defines the hosting engine\r\n   * @param successCallback defines the callback triggered once the data are available\r\n   * @param mimeType defines the mime type of the result\r\n   * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n   */\n\n\n  Tools.DumpFramebuffer = function (width, height, engine, successCallback, mimeType, fileName) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    } // Read the contents of the framebuffer\n\n\n    var numberOfChannelsByLine = width * 4;\n    var halfHeight = height / 2; //Reading datas from WebGL\n\n    var data = engine.readPixels(0, 0, width, height); //To flip image on Y axis.\n\n    for (var i = 0; i < halfHeight; i++) {\n      for (var j = 0; j < numberOfChannelsByLine; j++) {\n        var currentCell = j + i * numberOfChannelsByLine;\n        var targetLine = height - i - 1;\n        var targetCell = j + targetLine * numberOfChannelsByLine;\n        var temp = data[currentCell];\n        data[currentCell] = data[targetCell];\n        data[targetCell] = temp;\n      }\n    } // Create a 2D canvas to store the result\n\n\n    if (!Tools._ScreenshotCanvas) {\n      Tools._ScreenshotCanvas = document.createElement(\"canvas\");\n    }\n\n    Tools._ScreenshotCanvas.width = width;\n    Tools._ScreenshotCanvas.height = height;\n\n    var context = Tools._ScreenshotCanvas.getContext(\"2d\");\n\n    if (context) {\n      // Copy the pixels to a 2D canvas\n      var imageData = context.createImageData(width, height);\n      var castData = imageData.data;\n      castData.set(data);\n      context.putImageData(imageData, 0, 0);\n      Tools.EncodeScreenshotCanvasData(successCallback, mimeType, fileName);\n    }\n  };\n  /**\r\n   * Converts the canvas data to blob.\r\n   * This acts as a polyfill for browsers not supporting the to blob function.\r\n   * @param canvas Defines the canvas to extract the data from\r\n   * @param successCallback Defines the callback triggered once the data are available\r\n   * @param mimeType Defines the mime type of the result\r\n   */\n\n\n  Tools.ToBlob = function (canvas, successCallback, mimeType) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    } // We need HTMLCanvasElement.toBlob for HD screenshots\n\n\n    if (!canvas.toBlob) {\n      //  low performance polyfill based on toDataURL (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob)\n      canvas.toBlob = function (callback, type, quality) {\n        var _this = this;\n\n        setTimeout(function () {\n          var binStr = atob(_this.toDataURL(type, quality).split(\",\")[1]),\n              len = binStr.length,\n              arr = new Uint8Array(len);\n\n          for (var i = 0; i < len; i++) {\n            arr[i] = binStr.charCodeAt(i);\n          }\n\n          callback(new Blob([arr]));\n        });\n      };\n    }\n\n    canvas.toBlob(function (blob) {\n      successCallback(blob);\n    }, mimeType);\n  };\n  /**\r\n   * Encodes the canvas data to base 64 or automatically download the result if filename is defined\r\n   * @param successCallback defines the callback triggered once the data are available\r\n   * @param mimeType defines the mime type of the result\r\n   * @param fileName defines he filename to download. If present, the result will automatically be downloaded\r\n   */\n\n\n  Tools.EncodeScreenshotCanvasData = function (successCallback, mimeType, fileName) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    if (successCallback) {\n      var base64Image = Tools._ScreenshotCanvas.toDataURL(mimeType);\n\n      successCallback(base64Image);\n    } else {\n      this.ToBlob(Tools._ScreenshotCanvas, function (blob) {\n        //Creating a link if the browser have the download attribute on the a tag, to automatically start download generated image.\n        if (\"download\" in document.createElement(\"a\")) {\n          if (!fileName) {\n            var date = new Date();\n            var stringDate = (date.getFullYear() + \"-\" + (date.getMonth() + 1)).slice(2) + \"-\" + date.getDate() + \"_\" + date.getHours() + \"-\" + (\"0\" + date.getMinutes()).slice(-2);\n            fileName = \"screenshot_\" + stringDate + \".png\";\n          }\n\n          Tools.Download(blob, fileName);\n        } else {\n          var url = URL.createObjectURL(blob);\n          var newWindow = window.open(\"\");\n\n          if (!newWindow) {\n            return;\n          }\n\n          var img = newWindow.document.createElement(\"img\");\n\n          img.onload = function () {\n            // no longer need to read the blob so it's revoked\n            URL.revokeObjectURL(url);\n          };\n\n          img.src = url;\n          newWindow.document.body.appendChild(img);\n        }\n      }, mimeType);\n    }\n  };\n  /**\r\n   * Downloads a blob in the browser\r\n   * @param blob defines the blob to download\r\n   * @param fileName defines the name of the downloaded file\r\n   */\n\n\n  Tools.Download = function (blob, fileName) {\n    if (navigator && navigator.msSaveBlob) {\n      navigator.msSaveBlob(blob, fileName);\n      return;\n    }\n\n    var url = window.URL.createObjectURL(blob);\n    var a = document.createElement(\"a\");\n    document.body.appendChild(a);\n    a.style.display = \"none\";\n    a.href = url;\n    a.download = fileName;\n    a.addEventListener(\"click\", function () {\n      if (a.parentElement) {\n        a.parentElement.removeChild(a);\n      }\n    });\n    a.click();\n    window.URL.revokeObjectURL(url);\n  };\n  /**\r\n   * Will return the right value of the noPreventDefault variable\r\n   * Needed to keep backwards compatibility to the old API.\r\n   *\r\n   * @param args arguments passed to the attachControl function\r\n   * @returns the correct value for noPreventDefault\r\n   */\n\n\n  Tools.BackCompatCameraNoPreventDefault = function (args) {\n    // is it used correctly?\n    if (typeof args[0] === \"boolean\") {\n      return args[0];\n    } else if (typeof args[1] === \"boolean\") {\n      return args[1];\n    }\n\n    return false;\n  };\n  /**\r\n   * Captures a screenshot of the current rendering\r\n   * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n   * @param engine defines the rendering engine\r\n   * @param camera defines the source camera\r\n   * @param size This parameter can be set to a single number or to an object with the\r\n   * following (optional) properties: precision, width, height. If a single number is passed,\r\n   * it will be used for both width and height. If an object is passed, the screenshot size\r\n   * will be derived from the parameters. The precision property is a multiplier allowing\r\n   * rendering at a higher or lower resolution\r\n   * @param successCallback defines the callback receives a single parameter which contains the\r\n   * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n   * src parameter of an <img> to display it\r\n   * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n   * Check your browser for supported MIME types\r\n   */\n\n\n  Tools.CreateScreenshot = function (engine, camera, size, successCallback, mimeType) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    throw _DevTools.WarnImport(\"ScreenshotTools\");\n  };\n  /**\r\n   * Captures a screenshot of the current rendering\r\n   * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n   * @param engine defines the rendering engine\r\n   * @param camera defines the source camera\r\n   * @param size This parameter can be set to a single number or to an object with the\r\n   * following (optional) properties: precision, width, height. If a single number is passed,\r\n   * it will be used for both width and height. If an object is passed, the screenshot size\r\n   * will be derived from the parameters. The precision property is a multiplier allowing\r\n   * rendering at a higher or lower resolution\r\n   * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n   * Check your browser for supported MIME types\r\n   * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n   * to the src parameter of an <img> to display it\r\n   */\n\n\n  Tools.CreateScreenshotAsync = function (engine, camera, size, mimeType) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    throw _DevTools.WarnImport(\"ScreenshotTools\");\n  };\n  /**\r\n   * Generates an image screenshot from the specified camera.\r\n   * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n   * @param engine The engine to use for rendering\r\n   * @param camera The camera to use for rendering\r\n   * @param size This parameter can be set to a single number or to an object with the\r\n   * following (optional) properties: precision, width, height. If a single number is passed,\r\n   * it will be used for both width and height. If an object is passed, the screenshot size\r\n   * will be derived from the parameters. The precision property is a multiplier allowing\r\n   * rendering at a higher or lower resolution\r\n   * @param successCallback The callback receives a single parameter which contains the\r\n   * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n   * src parameter of an <img> to display it\r\n   * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n   * Check your browser for supported MIME types\r\n   * @param samples Texture samples (default: 1)\r\n   * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n   * @param fileName A name for for the downloaded file.\r\n   */\n\n\n  Tools.CreateScreenshotUsingRenderTarget = function (engine, camera, size, successCallback, mimeType, samples, antialiasing, fileName) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    if (samples === void 0) {\n      samples = 1;\n    }\n\n    if (antialiasing === void 0) {\n      antialiasing = false;\n    }\n\n    throw _DevTools.WarnImport(\"ScreenshotTools\");\n  };\n  /**\r\n   * Generates an image screenshot from the specified camera.\r\n   * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n   * @param engine The engine to use for rendering\r\n   * @param camera The camera to use for rendering\r\n   * @param size This parameter can be set to a single number or to an object with the\r\n   * following (optional) properties: precision, width, height. If a single number is passed,\r\n   * it will be used for both width and height. If an object is passed, the screenshot size\r\n   * will be derived from the parameters. The precision property is a multiplier allowing\r\n   * rendering at a higher or lower resolution\r\n   * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n   * Check your browser for supported MIME types\r\n   * @param samples Texture samples (default: 1)\r\n   * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n   * @param fileName A name for for the downloaded file.\r\n   * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n   * to the src parameter of an <img> to display it\r\n   */\n\n\n  Tools.CreateScreenshotUsingRenderTargetAsync = function (engine, camera, size, mimeType, samples, antialiasing, fileName) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    if (samples === void 0) {\n      samples = 1;\n    }\n\n    if (antialiasing === void 0) {\n      antialiasing = false;\n    }\n\n    throw _DevTools.WarnImport(\"ScreenshotTools\");\n  };\n  /**\r\n   * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\r\n   * Be aware Math.random() could cause collisions, but:\r\n   * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\r\n   * @returns a pseudo random id\r\n   */\n\n\n  Tools.RandomId = function () {\n    return GUID.RandomId();\n  };\n  /**\r\n   * Test if the given uri is a base64 string\r\n   * @param uri The uri to test\r\n   * @return True if the uri is a base64 string or false otherwise\r\n   */\n\n\n  Tools.IsBase64 = function (uri) {\n    return uri.length < 5 ? false : uri.substr(0, 5) === \"data:\";\n  };\n  /**\r\n   * Decode the given base64 uri.\r\n   * @param uri The uri to decode\r\n   * @return The decoded base64 data.\r\n   */\n\n\n  Tools.DecodeBase64 = function (uri) {\n    var decodedString = atob(uri.split(\",\")[1]);\n    var bufferLength = decodedString.length;\n    var bufferView = new Uint8Array(new ArrayBuffer(bufferLength));\n\n    for (var i = 0; i < bufferLength; i++) {\n      bufferView[i] = decodedString.charCodeAt(i);\n    }\n\n    return bufferView.buffer;\n  };\n  /**\r\n   * Gets the absolute url.\r\n   * @param url the input url\r\n   * @return the absolute url\r\n   */\n\n\n  Tools.GetAbsoluteUrl = function (url) {\n    var a = document.createElement(\"a\");\n    a.href = url;\n    return a.href;\n  };\n\n  Object.defineProperty(Tools, \"errorsCount\", {\n    /**\r\n     * Gets a value indicating the number of loading errors\r\n     * @ignorenaming\r\n     */\n    get: function () {\n      return Logger.errorsCount;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Log a message to the console\r\n   * @param message defines the message to log\r\n   */\n\n  Tools.Log = function (message) {\n    Logger.Log(message);\n  };\n  /**\r\n   * Write a warning message to the console\r\n   * @param message defines the message to log\r\n   */\n\n\n  Tools.Warn = function (message) {\n    Logger.Warn(message);\n  };\n  /**\r\n   * Write an error message to the console\r\n   * @param message defines the message to log\r\n   */\n\n\n  Tools.Error = function (message) {\n    Logger.Error(message);\n  };\n\n  Object.defineProperty(Tools, \"LogCache\", {\n    /**\r\n     * Gets current log cache (list of logs)\r\n     */\n    get: function () {\n      return Logger.LogCache;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Clears the log cache\r\n   */\n\n  Tools.ClearLogCache = function () {\n    Logger.ClearLogCache();\n  };\n\n  Object.defineProperty(Tools, \"LogLevels\", {\n    /**\r\n     * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\r\n     */\n    set: function (level) {\n      Logger.LogLevels = level;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"PerformanceLogLevel\", {\n    /**\r\n     * Sets the current performance log level\r\n     */\n    set: function (level) {\n      if ((level & Tools.PerformanceUserMarkLogLevel) === Tools.PerformanceUserMarkLogLevel) {\n        Tools.StartPerformanceCounter = Tools._StartUserMark;\n        Tools.EndPerformanceCounter = Tools._EndUserMark;\n        return;\n      }\n\n      if ((level & Tools.PerformanceConsoleLogLevel) === Tools.PerformanceConsoleLogLevel) {\n        Tools.StartPerformanceCounter = Tools._StartPerformanceConsole;\n        Tools.EndPerformanceCounter = Tools._EndPerformanceConsole;\n        return;\n      }\n\n      Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\n      Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  Tools._StartPerformanceCounterDisabled = function (counterName, condition) {};\n\n  Tools._EndPerformanceCounterDisabled = function (counterName, condition) {};\n\n  Tools._StartUserMark = function (counterName, condition) {\n    if (condition === void 0) {\n      condition = true;\n    }\n\n    if (!Tools._performance) {\n      if (!DomManagement.IsWindowObjectExist()) {\n        return;\n      }\n\n      Tools._performance = window.performance;\n    }\n\n    if (!condition || !Tools._performance.mark) {\n      return;\n    }\n\n    Tools._performance.mark(counterName + \"-Begin\");\n  };\n\n  Tools._EndUserMark = function (counterName, condition) {\n    if (condition === void 0) {\n      condition = true;\n    }\n\n    if (!condition || !Tools._performance.mark) {\n      return;\n    }\n\n    Tools._performance.mark(counterName + \"-End\");\n\n    Tools._performance.measure(counterName, counterName + \"-Begin\", counterName + \"-End\");\n  };\n\n  Tools._StartPerformanceConsole = function (counterName, condition) {\n    if (condition === void 0) {\n      condition = true;\n    }\n\n    if (!condition) {\n      return;\n    }\n\n    Tools._StartUserMark(counterName, condition);\n\n    if (console.time) {\n      console.time(counterName);\n    }\n  };\n\n  Tools._EndPerformanceConsole = function (counterName, condition) {\n    if (condition === void 0) {\n      condition = true;\n    }\n\n    if (!condition) {\n      return;\n    }\n\n    Tools._EndUserMark(counterName, condition);\n\n    console.timeEnd(counterName);\n  };\n\n  Object.defineProperty(Tools, \"Now\", {\n    /**\r\n     * Gets either window.performance.now() if supported or Date.now() else\r\n     */\n    get: function () {\n      return PrecisionDate.Now;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * This method will return the name of the class used to create the instance of the given object.\r\n   * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator.\r\n   * @param object the object to get the class name from\r\n   * @param isType defines if the object is actually a type\r\n   * @returns the name of the class, will be \"object\" for a custom data type not using the @className decorator\r\n   */\n\n  Tools.GetClassName = function (object, isType) {\n    if (isType === void 0) {\n      isType = false;\n    }\n\n    var name = null;\n\n    if (!isType && object.getClassName) {\n      name = object.getClassName();\n    } else {\n      if (object instanceof Object) {\n        var classObj = isType ? object : Object.getPrototypeOf(object);\n        name = classObj.constructor[\"__bjsclassName__\"];\n      }\n\n      if (!name) {\n        name = typeof object;\n      }\n    }\n\n    return name;\n  };\n  /**\r\n   * Gets the first element of an array satisfying a given predicate\r\n   * @param array defines the array to browse\r\n   * @param predicate defines the predicate to use\r\n   * @returns null if not found or the element\r\n   */\n\n\n  Tools.First = function (array, predicate) {\n    for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\n      var el = array_1[_i];\n\n      if (predicate(el)) {\n        return el;\n      }\n    }\n\n    return null;\n  };\n  /**\r\n   * This method will return the name of the full name of the class, including its owning module (if any).\r\n   * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator or implementing a method getClassName():string (in which case the module won't be specified).\r\n   * @param object the object to get the class name from\r\n   * @param isType defines if the object is actually a type\r\n   * @return a string that can have two forms: \"moduleName.className\" if module was specified when the class' Name was registered or \"className\" if there was not module specified.\r\n   * @ignorenaming\r\n   */\n\n\n  Tools.getFullClassName = function (object, isType) {\n    if (isType === void 0) {\n      isType = false;\n    }\n\n    var className = null;\n    var moduleName = null;\n\n    if (!isType && object.getClassName) {\n      className = object.getClassName();\n    } else {\n      if (object instanceof Object) {\n        var classObj = isType ? object : Object.getPrototypeOf(object);\n        className = classObj.constructor[\"__bjsclassName__\"];\n        moduleName = classObj.constructor[\"__bjsmoduleName__\"];\n      }\n\n      if (!className) {\n        className = typeof object;\n      }\n    }\n\n    if (!className) {\n      return null;\n    }\n\n    return (moduleName != null ? moduleName + \".\" : \"\") + className;\n  };\n  /**\r\n   * Returns a promise that resolves after the given amount of time.\r\n   * @param delay Number of milliseconds to delay\r\n   * @returns Promise that resolves after the given amount of time\r\n   */\n\n\n  Tools.DelayAsync = function (delay) {\n    return new Promise(function (resolve) {\n      setTimeout(function () {\n        resolve();\n      }, delay);\n    });\n  };\n  /**\r\n   * Utility function to detect if the current user agent is Safari\r\n   * @returns whether or not the current user agent is safari\r\n   */\n\n\n  Tools.IsSafari = function () {\n    return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n  };\n  /**\r\n   * Enable/Disable Custom HTTP Request Headers globally.\r\n   * default = false\r\n   * @see CustomRequestHeaders\r\n   */\n\n\n  Tools.UseCustomRequestHeaders = false;\n  /**\r\n   * Custom HTTP Request Headers to be sent with XMLHttpRequests\r\n   * i.e. when loading files, where the server/service expects an Authorization header\r\n   */\n\n  Tools.CustomRequestHeaders = WebRequest.CustomRequestHeaders;\n  Tools._tmpFloatArray = new Float32Array(1);\n  /**\r\n   * Extracts text content from a DOM element hierarchy\r\n   * Back Compat only, please use DomManagement.GetDOMTextContent instead.\r\n   */\n\n  Tools.GetDOMTextContent = DomManagement.GetDOMTextContent; // Logs\n\n  /**\r\n   * No log\r\n   */\n\n  Tools.NoneLogLevel = Logger.NoneLogLevel;\n  /**\r\n   * Only message logs\r\n   */\n\n  Tools.MessageLogLevel = Logger.MessageLogLevel;\n  /**\r\n   * Only warning logs\r\n   */\n\n  Tools.WarningLogLevel = Logger.WarningLogLevel;\n  /**\r\n   * Only error logs\r\n   */\n\n  Tools.ErrorLogLevel = Logger.ErrorLogLevel;\n  /**\r\n   * All logs\r\n   */\n\n  Tools.AllLogLevel = Logger.AllLogLevel;\n  /**\r\n   * Checks if the window object exists\r\n   * Back Compat only, please use DomManagement.IsWindowObjectExist instead.\r\n   */\n\n  Tools.IsWindowObjectExist = DomManagement.IsWindowObjectExist; // Performances\n\n  /**\r\n   * No performance log\r\n   */\n\n  Tools.PerformanceNoneLogLevel = 0;\n  /**\r\n   * Use user marks to log performance\r\n   */\n\n  Tools.PerformanceUserMarkLogLevel = 1;\n  /**\r\n   * Log performance to the console\r\n   */\n\n  Tools.PerformanceConsoleLogLevel = 2;\n  /**\r\n   * Starts a performance counter\r\n   */\n\n  Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\n  /**\r\n   * Ends a specific performance coutner\r\n   */\n\n  Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\n  return Tools;\n}();\n\nexport { Tools };\n/**\r\n * Use this className as a decorator on a given class definition to add it a name and optionally its module.\r\n * You can then use the Tools.getClassName(obj) on an instance to retrieve its class name.\r\n * This method is the only way to get it done in all cases, even if the .js file declaring the class is minified\r\n * @param name The name of the class, case should be preserved\r\n * @param module The name of the Module hosting the class, optional, but strongly recommended to specify if possible. Case should be preserved.\r\n */\n\nexport function className(name, module) {\n  return function (target) {\n    target[\"__bjsclassName__\"] = name;\n    target[\"__bjsmoduleName__\"] = module != null ? module : null;\n  };\n}\n/**\r\n * An implementation of a loop for asynchronous functions.\r\n */\n\nvar AsyncLoop =\n/** @class */\nfunction () {\n  /**\r\n   * Constructor.\r\n   * @param iterations the number of iterations.\r\n   * @param func the function to run each iteration\r\n   * @param successCallback the callback that will be called upon succesful execution\r\n   * @param offset starting offset.\r\n   */\n  function AsyncLoop(\n  /**\r\n   * Defines the number of iterations for the loop\r\n   */\n  iterations, func, successCallback, offset) {\n    if (offset === void 0) {\n      offset = 0;\n    }\n\n    this.iterations = iterations;\n    this.index = offset - 1;\n    this._done = false;\n    this._fn = func;\n    this._successCallback = successCallback;\n  }\n  /**\r\n   * Execute the next iteration. Must be called after the last iteration was finished.\r\n   */\n\n\n  AsyncLoop.prototype.executeNext = function () {\n    if (!this._done) {\n      if (this.index + 1 < this.iterations) {\n        ++this.index;\n\n        this._fn(this);\n      } else {\n        this.breakLoop();\n      }\n    }\n  };\n  /**\r\n   * Break the loop and run the success callback.\r\n   */\n\n\n  AsyncLoop.prototype.breakLoop = function () {\n    this._done = true;\n\n    this._successCallback();\n  };\n  /**\r\n   * Create and run an async loop.\r\n   * @param iterations the number of iterations.\r\n   * @param fn the function to run each iteration\r\n   * @param successCallback the callback that will be called upon succesful execution\r\n   * @param offset starting offset.\r\n   * @returns the created async loop object\r\n   */\n\n\n  AsyncLoop.Run = function (iterations, fn, successCallback, offset) {\n    if (offset === void 0) {\n      offset = 0;\n    }\n\n    var loop = new AsyncLoop(iterations, fn, successCallback, offset);\n    loop.executeNext();\n    return loop;\n  };\n  /**\r\n   * A for-loop that will run a given number of iterations synchronous and the rest async.\r\n   * @param iterations total number of iterations\r\n   * @param syncedIterations number of synchronous iterations in each async iteration.\r\n   * @param fn the function to call each iteration.\r\n   * @param callback a success call back that will be called when iterating stops.\r\n   * @param breakFunction a break condition (optional)\r\n   * @param timeout timeout settings for the setTimeout function. default - 0.\r\n   * @returns the created async loop object\r\n   */\n\n\n  AsyncLoop.SyncAsyncForLoop = function (iterations, syncedIterations, fn, callback, breakFunction, timeout) {\n    if (timeout === void 0) {\n      timeout = 0;\n    }\n\n    return AsyncLoop.Run(Math.ceil(iterations / syncedIterations), function (loop) {\n      if (breakFunction && breakFunction()) {\n        loop.breakLoop();\n      } else {\n        setTimeout(function () {\n          for (var i = 0; i < syncedIterations; ++i) {\n            var iteration = loop.index * syncedIterations + i;\n\n            if (iteration >= iterations) {\n              break;\n            }\n\n            fn(iteration);\n\n            if (breakFunction && breakFunction()) {\n              loop.breakLoop();\n              break;\n            }\n          }\n\n          loop.executeNext();\n        }, timeout);\n      }\n    }, callback);\n  };\n\n  return AsyncLoop;\n}();\n\nexport { AsyncLoop }; // Will only be define if Tools is imported freeing up some space when only engine is required\n\nEngineStore.FallbackTexture = \"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z\"; // Register promise fallback for IE\n\nPromisePolyfill.Apply();","map":{"version":3,"sources":["C:/Users/rober/Documents/Computer Science/Side Projects/arcade/node_modules/@babylonjs/core/Misc/tools.js"],"names":["Observable","DomManagement","Logger","DeepCopier","PrecisionDate","_DevTools","WebRequest","EngineStore","FileTools","PromisePolyfill","TimingTools","InstantiationTools","GUID","Tools","Object","defineProperty","get","BaseUrl","set","value","enumerable","configurable","DefaultRetryStrategy","strategy","CorsBehavior","UseFallbackTexture","RegisteredExternalClasses","classes","FallbackTexture","FetchToRef","u","v","width","height","pixels","color","wrappedU","Math","abs","wrappedV","position","r","g","b","a","Mix","alpha","Instantiate","className","Slice","data","start","end","slice","Array","prototype","call","SliceToArray","isArray","SetImmediate","action","IsExponentOfTwo","count","FloatRound","fround","_tmpFloatArray","GetFilename","path","index","lastIndexOf","substring","GetFolderPath","uri","returnUnchangedIfNoSlash","ToDegrees","angle","PI","ToRadians","MakeArray","obj","allowsNullUndefined","undefined","GetPointerPrefix","engine","eventPrefix","IsWindowObjectExist","window","PointerEvent","IsNavigatorAvailable","navigator","pointerEnabled","_badDesktopOS","_badOS","document","SetCorsBehavior","url","element","CleanUrl","replace","PreprocessUrl","processor","LoadImage","input","onLoad","onError","offlineProvider","mimeType","LoadFile","onSuccess","onProgress","useArrayBuffer","LoadFileAsync","Promise","resolve","reject","request","exception","LoadScript","scriptUrl","scriptId","head","getElementsByTagName","script","createElement","setAttribute","id","onload","onerror","e","appendChild","LoadScriptAsync","_this","message","ReadFileAsDataURL","fileToLoad","callback","progressCallback","reader","FileReader","onCompleteObservable","abort","onloadend","notifyObservers","target","onprogress","readAsDataURL","ReadFile","file","FileAsURL","content","fileBlob","Blob","URL","webkitURL","link","createObjectURL","Format","decimals","toFixed","DeepCopy","source","destination","doNotCopyList","mustCopyList","IsEmpty","i","hasOwnProperty","RegisterTopRootEvents","windowElement","events","length","event","addEventListener","name","handler","parent","UnregisterTopRootEvents","removeEventListener","DumpFramebuffer","successCallback","fileName","numberOfChannelsByLine","halfHeight","readPixels","j","currentCell","targetLine","targetCell","temp","_ScreenshotCanvas","context","getContext","imageData","createImageData","castData","putImageData","EncodeScreenshotCanvasData","ToBlob","canvas","toBlob","type","quality","setTimeout","binStr","atob","toDataURL","split","len","arr","Uint8Array","charCodeAt","blob","base64Image","date","Date","stringDate","getFullYear","getMonth","getDate","getHours","getMinutes","Download","newWindow","open","img","revokeObjectURL","src","body","msSaveBlob","style","display","href","download","parentElement","removeChild","click","BackCompatCameraNoPreventDefault","args","CreateScreenshot","camera","size","WarnImport","CreateScreenshotAsync","CreateScreenshotUsingRenderTarget","samples","antialiasing","CreateScreenshotUsingRenderTargetAsync","RandomId","IsBase64","substr","DecodeBase64","decodedString","bufferLength","bufferView","ArrayBuffer","buffer","GetAbsoluteUrl","errorsCount","Log","Warn","Error","LogCache","ClearLogCache","level","LogLevels","PerformanceUserMarkLogLevel","StartPerformanceCounter","_StartUserMark","EndPerformanceCounter","_EndUserMark","PerformanceConsoleLogLevel","_StartPerformanceConsole","_EndPerformanceConsole","_StartPerformanceCounterDisabled","_EndPerformanceCounterDisabled","counterName","condition","_performance","performance","mark","measure","console","time","timeEnd","Now","GetClassName","object","isType","getClassName","classObj","getPrototypeOf","constructor","First","array","predicate","_i","array_1","el","getFullClassName","moduleName","DelayAsync","delay","IsSafari","test","userAgent","UseCustomRequestHeaders","CustomRequestHeaders","Float32Array","GetDOMTextContent","NoneLogLevel","MessageLogLevel","WarningLogLevel","ErrorLogLevel","AllLogLevel","PerformanceNoneLogLevel","module","AsyncLoop","iterations","func","offset","_done","_fn","_successCallback","executeNext","breakLoop","Run","fn","loop","SyncAsyncForLoop","syncedIterations","breakFunction","timeout","ceil","iteration","Apply"],"mappings":"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","sourcesContent":["import { Observable } from \"./observable\";\r\nimport { DomManagement } from \"./domManagement\";\r\nimport { Logger } from \"./logger\";\r\nimport { DeepCopier } from \"./deepCopier\";\r\nimport { PrecisionDate } from \"./precisionDate\";\r\nimport { _DevTools } from \"./devTools\";\r\nimport { WebRequest } from \"./webRequest\";\r\nimport { EngineStore } from \"../Engines/engineStore\";\r\nimport { FileTools } from \"./fileTools\";\r\nimport { PromisePolyfill } from \"./promise\";\r\nimport { TimingTools } from \"./timingTools\";\r\nimport { InstantiationTools } from \"./instantiationTools\";\r\nimport { GUID } from \"./guid\";\r\n/**\r\n * Class containing a set of static utilities functions\r\n */\r\nvar Tools = /** @class */ (function () {\r\n    function Tools() {\r\n    }\r\n    Object.defineProperty(Tools, \"BaseUrl\", {\r\n        /**\r\n         * Gets or sets the base URL to use to load assets\r\n         */\r\n        get: function () {\r\n            return FileTools.BaseUrl;\r\n        },\r\n        set: function (value) {\r\n            FileTools.BaseUrl = value;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Tools, \"DefaultRetryStrategy\", {\r\n        /**\r\n         * Gets or sets the retry strategy to apply when an error happens while loading an asset\r\n         */\r\n        get: function () {\r\n            return FileTools.DefaultRetryStrategy;\r\n        },\r\n        set: function (strategy) {\r\n            FileTools.DefaultRetryStrategy = strategy;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Tools, \"CorsBehavior\", {\r\n        /**\r\n         * Default behaviour for cors in the application.\r\n         * It can be a string if the expected behavior is identical in the entire app.\r\n         * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\r\n         */\r\n        get: function () {\r\n            return FileTools.CorsBehavior;\r\n        },\r\n        set: function (value) {\r\n            FileTools.CorsBehavior = value;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Tools, \"UseFallbackTexture\", {\r\n        /**\r\n         * Gets or sets a global variable indicating if fallback texture must be used when a texture cannot be loaded\r\n         * @ignorenaming\r\n         */\r\n        get: function () {\r\n            return EngineStore.UseFallbackTexture;\r\n        },\r\n        set: function (value) {\r\n            EngineStore.UseFallbackTexture = value;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Tools, \"RegisteredExternalClasses\", {\r\n        /**\r\n         * Use this object to register external classes like custom textures or material\r\n         * to allow the laoders to instantiate them\r\n         */\r\n        get: function () {\r\n            return InstantiationTools.RegisteredExternalClasses;\r\n        },\r\n        set: function (classes) {\r\n            InstantiationTools.RegisteredExternalClasses = classes;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Tools, \"fallbackTexture\", {\r\n        /**\r\n         * Texture content used if a texture cannot loaded\r\n         * @ignorenaming\r\n         */\r\n        get: function () {\r\n            return EngineStore.FallbackTexture;\r\n        },\r\n        set: function (value) {\r\n            EngineStore.FallbackTexture = value;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Read the content of a byte array at a specified coordinates (taking in account wrapping)\r\n     * @param u defines the coordinate on X axis\r\n     * @param v defines the coordinate on Y axis\r\n     * @param width defines the width of the source data\r\n     * @param height defines the height of the source data\r\n     * @param pixels defines the source byte array\r\n     * @param color defines the output color\r\n     */\r\n    Tools.FetchToRef = function (u, v, width, height, pixels, color) {\r\n        var wrappedU = (Math.abs(u) * width) % width | 0;\r\n        var wrappedV = (Math.abs(v) * height) % height | 0;\r\n        var position = (wrappedU + wrappedV * width) * 4;\r\n        color.r = pixels[position] / 255;\r\n        color.g = pixels[position + 1] / 255;\r\n        color.b = pixels[position + 2] / 255;\r\n        color.a = pixels[position + 3] / 255;\r\n    };\r\n    /**\r\n     * Interpolates between a and b via alpha\r\n     * @param a The lower value (returned when alpha = 0)\r\n     * @param b The upper value (returned when alpha = 1)\r\n     * @param alpha The interpolation-factor\r\n     * @return The mixed value\r\n     */\r\n    Tools.Mix = function (a, b, alpha) {\r\n        return a * (1 - alpha) + b * alpha;\r\n    };\r\n    /**\r\n     * Tries to instantiate a new object from a given class name\r\n     * @param className defines the class name to instantiate\r\n     * @returns the new object or null if the system was not able to do the instantiation\r\n     */\r\n    Tools.Instantiate = function (className) {\r\n        return InstantiationTools.Instantiate(className);\r\n    };\r\n    /**\r\n     * Provides a slice function that will work even on IE\r\n     * @param data defines the array to slice\r\n     * @param start defines the start of the data (optional)\r\n     * @param end defines the end of the data (optional)\r\n     * @returns the new sliced array\r\n     */\r\n    Tools.Slice = function (data, start, end) {\r\n        if (data.slice) {\r\n            return data.slice(start, end);\r\n        }\r\n        return Array.prototype.slice.call(data, start, end);\r\n    };\r\n    /**\r\n     * Provides a slice function that will work even on IE\r\n     * The difference between this and Slice is that this will force-convert to array\r\n     * @param data defines the array to slice\r\n     * @param start defines the start of the data (optional)\r\n     * @param end defines the end of the data (optional)\r\n     * @returns the new sliced array\r\n     */\r\n    Tools.SliceToArray = function (data, start, end) {\r\n        if (Array.isArray(data)) {\r\n            return data.slice(start, end);\r\n        }\r\n        return Array.prototype.slice.call(data, start, end);\r\n    };\r\n    /**\r\n     * Polyfill for setImmediate\r\n     * @param action defines the action to execute after the current execution block\r\n     */\r\n    Tools.SetImmediate = function (action) {\r\n        TimingTools.SetImmediate(action);\r\n    };\r\n    /**\r\n     * Function indicating if a number is an exponent of 2\r\n     * @param value defines the value to test\r\n     * @returns true if the value is an exponent of 2\r\n     */\r\n    Tools.IsExponentOfTwo = function (value) {\r\n        var count = 1;\r\n        do {\r\n            count *= 2;\r\n        } while (count < value);\r\n        return count === value;\r\n    };\r\n    /**\r\n     * Returns the nearest 32-bit single precision float representation of a Number\r\n     * @param value A Number.  If the parameter is of a different type, it will get converted\r\n     * to a number or to NaN if it cannot be converted\r\n     * @returns number\r\n     */\r\n    Tools.FloatRound = function (value) {\r\n        if (Math.fround) {\r\n            return Math.fround(value);\r\n        }\r\n        return (Tools._tmpFloatArray[0] = value);\r\n    };\r\n    /**\r\n     * Extracts the filename from a path\r\n     * @param path defines the path to use\r\n     * @returns the filename\r\n     */\r\n    Tools.GetFilename = function (path) {\r\n        var index = path.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            return path;\r\n        }\r\n        return path.substring(index + 1);\r\n    };\r\n    /**\r\n     * Extracts the \"folder\" part of a path (everything before the filename).\r\n     * @param uri The URI to extract the info from\r\n     * @param returnUnchangedIfNoSlash Do not touch the URI if no slashes are present\r\n     * @returns The \"folder\" part of the path\r\n     */\r\n    Tools.GetFolderPath = function (uri, returnUnchangedIfNoSlash) {\r\n        if (returnUnchangedIfNoSlash === void 0) { returnUnchangedIfNoSlash = false; }\r\n        var index = uri.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            if (returnUnchangedIfNoSlash) {\r\n                return uri;\r\n            }\r\n            return \"\";\r\n        }\r\n        return uri.substring(0, index + 1);\r\n    };\r\n    /**\r\n     * Convert an angle in radians to degrees\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in degrees\r\n     */\r\n    Tools.ToDegrees = function (angle) {\r\n        return (angle * 180) / Math.PI;\r\n    };\r\n    /**\r\n     * Convert an angle in degrees to radians\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in radians\r\n     */\r\n    Tools.ToRadians = function (angle) {\r\n        return (angle * Math.PI) / 180;\r\n    };\r\n    /**\r\n     * Returns an array if obj is not an array\r\n     * @param obj defines the object to evaluate as an array\r\n     * @param allowsNullUndefined defines a boolean indicating if obj is allowed to be null or undefined\r\n     * @returns either obj directly if obj is an array or a new array containing obj\r\n     */\r\n    Tools.MakeArray = function (obj, allowsNullUndefined) {\r\n        if (allowsNullUndefined !== true && (obj === undefined || obj == null)) {\r\n            return null;\r\n        }\r\n        return Array.isArray(obj) ? obj : [obj];\r\n    };\r\n    /**\r\n     * Gets the pointer prefix to use\r\n     * @param engine defines the engine we are finding the prefix for\r\n     * @returns \"pointer\" if touch is enabled. Else returns \"mouse\"\r\n     */\r\n    Tools.GetPointerPrefix = function (engine) {\r\n        var eventPrefix = \"pointer\";\r\n        // Check if pointer events are supported\r\n        if (DomManagement.IsWindowObjectExist() && !window.PointerEvent && DomManagement.IsNavigatorAvailable() && !navigator.pointerEnabled) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n        // Special Fallback MacOS Safari...\r\n        if (engine._badDesktopOS &&\r\n            !engine._badOS &&\r\n            // And not ipad pros who claim to be macs...\r\n            !(document && \"ontouchend\" in document)) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n        return eventPrefix;\r\n    };\r\n    /**\r\n     * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\r\n     * @param url define the url we are trying\r\n     * @param element define the dom element where to configure the cors policy\r\n     */\r\n    Tools.SetCorsBehavior = function (url, element) {\r\n        FileTools.SetCorsBehavior(url, element);\r\n    };\r\n    // External files\r\n    /**\r\n     * Removes unwanted characters from an url\r\n     * @param url defines the url to clean\r\n     * @returns the cleaned url\r\n     */\r\n    Tools.CleanUrl = function (url) {\r\n        url = url.replace(/#/gm, \"%23\");\r\n        return url;\r\n    };\r\n    Object.defineProperty(Tools, \"PreprocessUrl\", {\r\n        /**\r\n         * Gets or sets a function used to pre-process url before using them to load assets\r\n         */\r\n        get: function () {\r\n            return FileTools.PreprocessUrl;\r\n        },\r\n        set: function (processor) {\r\n            FileTools.PreprocessUrl = processor;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Loads an image as an HTMLImageElement.\r\n     * @param input url string, ArrayBuffer, or Blob to load\r\n     * @param onLoad callback called when the image successfully loads\r\n     * @param onError callback called when the image fails to load\r\n     * @param offlineProvider offline provider for caching\r\n     * @param mimeType optional mime type\r\n     * @returns the HTMLImageElement of the loaded image\r\n     */\r\n    Tools.LoadImage = function (input, onLoad, onError, offlineProvider, mimeType) {\r\n        return FileTools.LoadImage(input, onLoad, onError, offlineProvider, mimeType);\r\n    };\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url string, ArrayBuffer, or Blob to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     */\r\n    Tools.LoadFile = function (url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError) {\r\n        return FileTools.LoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n    };\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url the file url to load\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @returns a promise containing an ArrayBuffer corresponding to the loaded file\r\n     */\r\n    Tools.LoadFileAsync = function (url, useArrayBuffer) {\r\n        if (useArrayBuffer === void 0) { useArrayBuffer = true; }\r\n        return new Promise(function (resolve, reject) {\r\n            FileTools.LoadFile(url, function (data) {\r\n                resolve(data);\r\n            }, undefined, undefined, useArrayBuffer, function (request, exception) {\r\n                reject(exception);\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Load a script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @param onSuccess defines the callback called when the script is loaded\r\n     * @param onError defines the callback to call if an error occurs\r\n     * @param scriptId defines the id of the script element\r\n     */\r\n    Tools.LoadScript = function (scriptUrl, onSuccess, onError, scriptId) {\r\n        if (!DomManagement.IsWindowObjectExist()) {\r\n            return;\r\n        }\r\n        var head = document.getElementsByTagName(\"head\")[0];\r\n        var script = document.createElement(\"script\");\r\n        script.setAttribute(\"type\", \"text/javascript\");\r\n        script.setAttribute(\"src\", scriptUrl);\r\n        if (scriptId) {\r\n            script.id = scriptId;\r\n        }\r\n        script.onload = function () {\r\n            if (onSuccess) {\r\n                onSuccess();\r\n            }\r\n        };\r\n        script.onerror = function (e) {\r\n            if (onError) {\r\n                onError(\"Unable to load script '\" + scriptUrl + \"'\", e);\r\n            }\r\n        };\r\n        head.appendChild(script);\r\n    };\r\n    /**\r\n     * Load an asynchronous script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @param scriptId defines the id of the script element\r\n     * @returns a promise request object\r\n     */\r\n    Tools.LoadScriptAsync = function (scriptUrl, scriptId) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.LoadScript(scriptUrl, function () {\r\n                resolve();\r\n            }, function (message, exception) {\r\n                reject(exception);\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Loads a file from a blob\r\n     * @param fileToLoad defines the blob to use\r\n     * @param callback defines the callback to call when data is loaded\r\n     * @param progressCallback defines the callback to call during loading process\r\n     * @returns a file request object\r\n     */\r\n    Tools.ReadFileAsDataURL = function (fileToLoad, callback, progressCallback) {\r\n        var reader = new FileReader();\r\n        var request = {\r\n            onCompleteObservable: new Observable(),\r\n            abort: function () { return reader.abort(); },\r\n        };\r\n        reader.onloadend = function (e) {\r\n            request.onCompleteObservable.notifyObservers(request);\r\n        };\r\n        reader.onload = function (e) {\r\n            //target doesn't have result from ts 1.3\r\n            callback(e.target[\"result\"]);\r\n        };\r\n        reader.onprogress = progressCallback;\r\n        reader.readAsDataURL(fileToLoad);\r\n        return request;\r\n    };\r\n    /**\r\n     * Reads a file from a File object\r\n     * @param file defines the file to load\r\n     * @param onSuccess defines the callback to call when data is loaded\r\n     * @param onProgress defines the callback to call during loading process\r\n     * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\r\n     * @param onError defines the callback to call when an error occurs\r\n     * @returns a file request object\r\n     */\r\n    Tools.ReadFile = function (file, onSuccess, onProgress, useArrayBuffer, onError) {\r\n        return FileTools.ReadFile(file, onSuccess, onProgress, useArrayBuffer, onError);\r\n    };\r\n    /**\r\n     * Creates a data url from a given string content\r\n     * @param content defines the content to convert\r\n     * @returns the new data url link\r\n     */\r\n    Tools.FileAsURL = function (content) {\r\n        var fileBlob = new Blob([content]);\r\n        var url = window.URL || window.webkitURL;\r\n        var link = url.createObjectURL(fileBlob);\r\n        return link;\r\n    };\r\n    /**\r\n     * Format the given number to a specific decimal format\r\n     * @param value defines the number to format\r\n     * @param decimals defines the number of decimals to use\r\n     * @returns the formatted string\r\n     */\r\n    Tools.Format = function (value, decimals) {\r\n        if (decimals === void 0) { decimals = 2; }\r\n        return value.toFixed(decimals);\r\n    };\r\n    /**\r\n     * Tries to copy an object by duplicating every property\r\n     * @param source defines the source object\r\n     * @param destination defines the target object\r\n     * @param doNotCopyList defines a list of properties to avoid\r\n     * @param mustCopyList defines a list of properties to copy (even if they start with _)\r\n     */\r\n    Tools.DeepCopy = function (source, destination, doNotCopyList, mustCopyList) {\r\n        DeepCopier.DeepCopy(source, destination, doNotCopyList, mustCopyList);\r\n    };\r\n    /**\r\n     * Gets a boolean indicating if the given object has no own property\r\n     * @param obj defines the object to test\r\n     * @returns true if object has no own property\r\n     */\r\n    Tools.IsEmpty = function (obj) {\r\n        for (var i in obj) {\r\n            if (obj.hasOwnProperty(i)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * Function used to register events at window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to register\r\n     */\r\n    Tools.RegisterTopRootEvents = function (windowElement, events) {\r\n        for (var index = 0; index < events.length; index++) {\r\n            var event = events[index];\r\n            windowElement.addEventListener(event.name, event.handler, false);\r\n            try {\r\n                if (window.parent) {\r\n                    window.parent.addEventListener(event.name, event.handler, false);\r\n                }\r\n            }\r\n            catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Function used to unregister events from window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to unregister\r\n     */\r\n    Tools.UnregisterTopRootEvents = function (windowElement, events) {\r\n        for (var index = 0; index < events.length; index++) {\r\n            var event = events[index];\r\n            windowElement.removeEventListener(event.name, event.handler);\r\n            try {\r\n                if (windowElement.parent) {\r\n                    windowElement.parent.removeEventListener(event.name, event.handler);\r\n                }\r\n            }\r\n            catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Dumps the current bound framebuffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param engine defines the hosting engine\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     */\r\n    Tools.DumpFramebuffer = function (width, height, engine, successCallback, mimeType, fileName) {\r\n        if (mimeType === void 0) { mimeType = \"image/png\"; }\r\n        // Read the contents of the framebuffer\r\n        var numberOfChannelsByLine = width * 4;\r\n        var halfHeight = height / 2;\r\n        //Reading datas from WebGL\r\n        var data = engine.readPixels(0, 0, width, height);\r\n        //To flip image on Y axis.\r\n        for (var i = 0; i < halfHeight; i++) {\r\n            for (var j = 0; j < numberOfChannelsByLine; j++) {\r\n                var currentCell = j + i * numberOfChannelsByLine;\r\n                var targetLine = height - i - 1;\r\n                var targetCell = j + targetLine * numberOfChannelsByLine;\r\n                var temp = data[currentCell];\r\n                data[currentCell] = data[targetCell];\r\n                data[targetCell] = temp;\r\n            }\r\n        }\r\n        // Create a 2D canvas to store the result\r\n        if (!Tools._ScreenshotCanvas) {\r\n            Tools._ScreenshotCanvas = document.createElement(\"canvas\");\r\n        }\r\n        Tools._ScreenshotCanvas.width = width;\r\n        Tools._ScreenshotCanvas.height = height;\r\n        var context = Tools._ScreenshotCanvas.getContext(\"2d\");\r\n        if (context) {\r\n            // Copy the pixels to a 2D canvas\r\n            var imageData = context.createImageData(width, height);\r\n            var castData = imageData.data;\r\n            castData.set(data);\r\n            context.putImageData(imageData, 0, 0);\r\n            Tools.EncodeScreenshotCanvasData(successCallback, mimeType, fileName);\r\n        }\r\n    };\r\n    /**\r\n     * Converts the canvas data to blob.\r\n     * This acts as a polyfill for browsers not supporting the to blob function.\r\n     * @param canvas Defines the canvas to extract the data from\r\n     * @param successCallback Defines the callback triggered once the data are available\r\n     * @param mimeType Defines the mime type of the result\r\n     */\r\n    Tools.ToBlob = function (canvas, successCallback, mimeType) {\r\n        if (mimeType === void 0) { mimeType = \"image/png\"; }\r\n        // We need HTMLCanvasElement.toBlob for HD screenshots\r\n        if (!canvas.toBlob) {\r\n            //  low performance polyfill based on toDataURL (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob)\r\n            canvas.toBlob = function (callback, type, quality) {\r\n                var _this = this;\r\n                setTimeout(function () {\r\n                    var binStr = atob(_this.toDataURL(type, quality).split(\",\")[1]), len = binStr.length, arr = new Uint8Array(len);\r\n                    for (var i = 0; i < len; i++) {\r\n                        arr[i] = binStr.charCodeAt(i);\r\n                    }\r\n                    callback(new Blob([arr]));\r\n                });\r\n            };\r\n        }\r\n        canvas.toBlob(function (blob) {\r\n            successCallback(blob);\r\n        }, mimeType);\r\n    };\r\n    /**\r\n     * Encodes the canvas data to base 64 or automatically download the result if filename is defined\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines he filename to download. If present, the result will automatically be downloaded\r\n     */\r\n    Tools.EncodeScreenshotCanvasData = function (successCallback, mimeType, fileName) {\r\n        if (mimeType === void 0) { mimeType = \"image/png\"; }\r\n        if (successCallback) {\r\n            var base64Image = Tools._ScreenshotCanvas.toDataURL(mimeType);\r\n            successCallback(base64Image);\r\n        }\r\n        else {\r\n            this.ToBlob(Tools._ScreenshotCanvas, function (blob) {\r\n                //Creating a link if the browser have the download attribute on the a tag, to automatically start download generated image.\r\n                if (\"download\" in document.createElement(\"a\")) {\r\n                    if (!fileName) {\r\n                        var date = new Date();\r\n                        var stringDate = (date.getFullYear() + \"-\" + (date.getMonth() + 1)).slice(2) + \"-\" + date.getDate() + \"_\" + date.getHours() + \"-\" + (\"0\" + date.getMinutes()).slice(-2);\r\n                        fileName = \"screenshot_\" + stringDate + \".png\";\r\n                    }\r\n                    Tools.Download(blob, fileName);\r\n                }\r\n                else {\r\n                    var url = URL.createObjectURL(blob);\r\n                    var newWindow = window.open(\"\");\r\n                    if (!newWindow) {\r\n                        return;\r\n                    }\r\n                    var img = newWindow.document.createElement(\"img\");\r\n                    img.onload = function () {\r\n                        // no longer need to read the blob so it's revoked\r\n                        URL.revokeObjectURL(url);\r\n                    };\r\n                    img.src = url;\r\n                    newWindow.document.body.appendChild(img);\r\n                }\r\n            }, mimeType);\r\n        }\r\n    };\r\n    /**\r\n     * Downloads a blob in the browser\r\n     * @param blob defines the blob to download\r\n     * @param fileName defines the name of the downloaded file\r\n     */\r\n    Tools.Download = function (blob, fileName) {\r\n        if (navigator && navigator.msSaveBlob) {\r\n            navigator.msSaveBlob(blob, fileName);\r\n            return;\r\n        }\r\n        var url = window.URL.createObjectURL(blob);\r\n        var a = document.createElement(\"a\");\r\n        document.body.appendChild(a);\r\n        a.style.display = \"none\";\r\n        a.href = url;\r\n        a.download = fileName;\r\n        a.addEventListener(\"click\", function () {\r\n            if (a.parentElement) {\r\n                a.parentElement.removeChild(a);\r\n            }\r\n        });\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n    };\r\n    /**\r\n     * Will return the right value of the noPreventDefault variable\r\n     * Needed to keep backwards compatibility to the old API.\r\n     *\r\n     * @param args arguments passed to the attachControl function\r\n     * @returns the correct value for noPreventDefault\r\n     */\r\n    Tools.BackCompatCameraNoPreventDefault = function (args) {\r\n        // is it used correctly?\r\n        if (typeof args[0] === \"boolean\") {\r\n            return args[0];\r\n        }\r\n        else if (typeof args[1] === \"boolean\") {\r\n            return args[1];\r\n        }\r\n        return false;\r\n    };\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback defines the callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     */\r\n    Tools.CreateScreenshot = function (engine, camera, size, successCallback, mimeType) {\r\n        if (mimeType === void 0) { mimeType = \"image/png\"; }\r\n        throw _DevTools.WarnImport(\"ScreenshotTools\");\r\n    };\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    Tools.CreateScreenshotAsync = function (engine, camera, size, mimeType) {\r\n        if (mimeType === void 0) { mimeType = \"image/png\"; }\r\n        throw _DevTools.WarnImport(\"ScreenshotTools\");\r\n    };\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback The callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     */\r\n    Tools.CreateScreenshotUsingRenderTarget = function (engine, camera, size, successCallback, mimeType, samples, antialiasing, fileName) {\r\n        if (mimeType === void 0) { mimeType = \"image/png\"; }\r\n        if (samples === void 0) { samples = 1; }\r\n        if (antialiasing === void 0) { antialiasing = false; }\r\n        throw _DevTools.WarnImport(\"ScreenshotTools\");\r\n    };\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    Tools.CreateScreenshotUsingRenderTargetAsync = function (engine, camera, size, mimeType, samples, antialiasing, fileName) {\r\n        if (mimeType === void 0) { mimeType = \"image/png\"; }\r\n        if (samples === void 0) { samples = 1; }\r\n        if (antialiasing === void 0) { antialiasing = false; }\r\n        throw _DevTools.WarnImport(\"ScreenshotTools\");\r\n    };\r\n    /**\r\n     * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\r\n     * Be aware Math.random() could cause collisions, but:\r\n     * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\r\n     * @returns a pseudo random id\r\n     */\r\n    Tools.RandomId = function () {\r\n        return GUID.RandomId();\r\n    };\r\n    /**\r\n     * Test if the given uri is a base64 string\r\n     * @param uri The uri to test\r\n     * @return True if the uri is a base64 string or false otherwise\r\n     */\r\n    Tools.IsBase64 = function (uri) {\r\n        return uri.length < 5 ? false : uri.substr(0, 5) === \"data:\";\r\n    };\r\n    /**\r\n     * Decode the given base64 uri.\r\n     * @param uri The uri to decode\r\n     * @return The decoded base64 data.\r\n     */\r\n    Tools.DecodeBase64 = function (uri) {\r\n        var decodedString = atob(uri.split(\",\")[1]);\r\n        var bufferLength = decodedString.length;\r\n        var bufferView = new Uint8Array(new ArrayBuffer(bufferLength));\r\n        for (var i = 0; i < bufferLength; i++) {\r\n            bufferView[i] = decodedString.charCodeAt(i);\r\n        }\r\n        return bufferView.buffer;\r\n    };\r\n    /**\r\n     * Gets the absolute url.\r\n     * @param url the input url\r\n     * @return the absolute url\r\n     */\r\n    Tools.GetAbsoluteUrl = function (url) {\r\n        var a = document.createElement(\"a\");\r\n        a.href = url;\r\n        return a.href;\r\n    };\r\n    Object.defineProperty(Tools, \"errorsCount\", {\r\n        /**\r\n         * Gets a value indicating the number of loading errors\r\n         * @ignorenaming\r\n         */\r\n        get: function () {\r\n            return Logger.errorsCount;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Log a message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    Tools.Log = function (message) {\r\n        Logger.Log(message);\r\n    };\r\n    /**\r\n     * Write a warning message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    Tools.Warn = function (message) {\r\n        Logger.Warn(message);\r\n    };\r\n    /**\r\n     * Write an error message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    Tools.Error = function (message) {\r\n        Logger.Error(message);\r\n    };\r\n    Object.defineProperty(Tools, \"LogCache\", {\r\n        /**\r\n         * Gets current log cache (list of logs)\r\n         */\r\n        get: function () {\r\n            return Logger.LogCache;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Clears the log cache\r\n     */\r\n    Tools.ClearLogCache = function () {\r\n        Logger.ClearLogCache();\r\n    };\r\n    Object.defineProperty(Tools, \"LogLevels\", {\r\n        /**\r\n         * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\r\n         */\r\n        set: function (level) {\r\n            Logger.LogLevels = level;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Tools, \"PerformanceLogLevel\", {\r\n        /**\r\n         * Sets the current performance log level\r\n         */\r\n        set: function (level) {\r\n            if ((level & Tools.PerformanceUserMarkLogLevel) === Tools.PerformanceUserMarkLogLevel) {\r\n                Tools.StartPerformanceCounter = Tools._StartUserMark;\r\n                Tools.EndPerformanceCounter = Tools._EndUserMark;\r\n                return;\r\n            }\r\n            if ((level & Tools.PerformanceConsoleLogLevel) === Tools.PerformanceConsoleLogLevel) {\r\n                Tools.StartPerformanceCounter = Tools._StartPerformanceConsole;\r\n                Tools.EndPerformanceCounter = Tools._EndPerformanceConsole;\r\n                return;\r\n            }\r\n            Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\r\n            Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Tools._StartPerformanceCounterDisabled = function (counterName, condition) { };\r\n    Tools._EndPerformanceCounterDisabled = function (counterName, condition) { };\r\n    Tools._StartUserMark = function (counterName, condition) {\r\n        if (condition === void 0) { condition = true; }\r\n        if (!Tools._performance) {\r\n            if (!DomManagement.IsWindowObjectExist()) {\r\n                return;\r\n            }\r\n            Tools._performance = window.performance;\r\n        }\r\n        if (!condition || !Tools._performance.mark) {\r\n            return;\r\n        }\r\n        Tools._performance.mark(counterName + \"-Begin\");\r\n    };\r\n    Tools._EndUserMark = function (counterName, condition) {\r\n        if (condition === void 0) { condition = true; }\r\n        if (!condition || !Tools._performance.mark) {\r\n            return;\r\n        }\r\n        Tools._performance.mark(counterName + \"-End\");\r\n        Tools._performance.measure(counterName, counterName + \"-Begin\", counterName + \"-End\");\r\n    };\r\n    Tools._StartPerformanceConsole = function (counterName, condition) {\r\n        if (condition === void 0) { condition = true; }\r\n        if (!condition) {\r\n            return;\r\n        }\r\n        Tools._StartUserMark(counterName, condition);\r\n        if (console.time) {\r\n            console.time(counterName);\r\n        }\r\n    };\r\n    Tools._EndPerformanceConsole = function (counterName, condition) {\r\n        if (condition === void 0) { condition = true; }\r\n        if (!condition) {\r\n            return;\r\n        }\r\n        Tools._EndUserMark(counterName, condition);\r\n        console.timeEnd(counterName);\r\n    };\r\n    Object.defineProperty(Tools, \"Now\", {\r\n        /**\r\n         * Gets either window.performance.now() if supported or Date.now() else\r\n         */\r\n        get: function () {\r\n            return PrecisionDate.Now;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * This method will return the name of the class used to create the instance of the given object.\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator.\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @returns the name of the class, will be \"object\" for a custom data type not using the @className decorator\r\n     */\r\n    Tools.GetClassName = function (object, isType) {\r\n        if (isType === void 0) { isType = false; }\r\n        var name = null;\r\n        if (!isType && object.getClassName) {\r\n            name = object.getClassName();\r\n        }\r\n        else {\r\n            if (object instanceof Object) {\r\n                var classObj = isType ? object : Object.getPrototypeOf(object);\r\n                name = classObj.constructor[\"__bjsclassName__\"];\r\n            }\r\n            if (!name) {\r\n                name = typeof object;\r\n            }\r\n        }\r\n        return name;\r\n    };\r\n    /**\r\n     * Gets the first element of an array satisfying a given predicate\r\n     * @param array defines the array to browse\r\n     * @param predicate defines the predicate to use\r\n     * @returns null if not found or the element\r\n     */\r\n    Tools.First = function (array, predicate) {\r\n        for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\r\n            var el = array_1[_i];\r\n            if (predicate(el)) {\r\n                return el;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * This method will return the name of the full name of the class, including its owning module (if any).\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator or implementing a method getClassName():string (in which case the module won't be specified).\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @return a string that can have two forms: \"moduleName.className\" if module was specified when the class' Name was registered or \"className\" if there was not module specified.\r\n     * @ignorenaming\r\n     */\r\n    Tools.getFullClassName = function (object, isType) {\r\n        if (isType === void 0) { isType = false; }\r\n        var className = null;\r\n        var moduleName = null;\r\n        if (!isType && object.getClassName) {\r\n            className = object.getClassName();\r\n        }\r\n        else {\r\n            if (object instanceof Object) {\r\n                var classObj = isType ? object : Object.getPrototypeOf(object);\r\n                className = classObj.constructor[\"__bjsclassName__\"];\r\n                moduleName = classObj.constructor[\"__bjsmoduleName__\"];\r\n            }\r\n            if (!className) {\r\n                className = typeof object;\r\n            }\r\n        }\r\n        if (!className) {\r\n            return null;\r\n        }\r\n        return (moduleName != null ? moduleName + \".\" : \"\") + className;\r\n    };\r\n    /**\r\n     * Returns a promise that resolves after the given amount of time.\r\n     * @param delay Number of milliseconds to delay\r\n     * @returns Promise that resolves after the given amount of time\r\n     */\r\n    Tools.DelayAsync = function (delay) {\r\n        return new Promise(function (resolve) {\r\n            setTimeout(function () {\r\n                resolve();\r\n            }, delay);\r\n        });\r\n    };\r\n    /**\r\n     * Utility function to detect if the current user agent is Safari\r\n     * @returns whether or not the current user agent is safari\r\n     */\r\n    Tools.IsSafari = function () {\r\n        return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n    };\r\n    /**\r\n     * Enable/Disable Custom HTTP Request Headers globally.\r\n     * default = false\r\n     * @see CustomRequestHeaders\r\n     */\r\n    Tools.UseCustomRequestHeaders = false;\r\n    /**\r\n     * Custom HTTP Request Headers to be sent with XMLHttpRequests\r\n     * i.e. when loading files, where the server/service expects an Authorization header\r\n     */\r\n    Tools.CustomRequestHeaders = WebRequest.CustomRequestHeaders;\r\n    Tools._tmpFloatArray = new Float32Array(1);\r\n    /**\r\n     * Extracts text content from a DOM element hierarchy\r\n     * Back Compat only, please use DomManagement.GetDOMTextContent instead.\r\n     */\r\n    Tools.GetDOMTextContent = DomManagement.GetDOMTextContent;\r\n    // Logs\r\n    /**\r\n     * No log\r\n     */\r\n    Tools.NoneLogLevel = Logger.NoneLogLevel;\r\n    /**\r\n     * Only message logs\r\n     */\r\n    Tools.MessageLogLevel = Logger.MessageLogLevel;\r\n    /**\r\n     * Only warning logs\r\n     */\r\n    Tools.WarningLogLevel = Logger.WarningLogLevel;\r\n    /**\r\n     * Only error logs\r\n     */\r\n    Tools.ErrorLogLevel = Logger.ErrorLogLevel;\r\n    /**\r\n     * All logs\r\n     */\r\n    Tools.AllLogLevel = Logger.AllLogLevel;\r\n    /**\r\n     * Checks if the window object exists\r\n     * Back Compat only, please use DomManagement.IsWindowObjectExist instead.\r\n     */\r\n    Tools.IsWindowObjectExist = DomManagement.IsWindowObjectExist;\r\n    // Performances\r\n    /**\r\n     * No performance log\r\n     */\r\n    Tools.PerformanceNoneLogLevel = 0;\r\n    /**\r\n     * Use user marks to log performance\r\n     */\r\n    Tools.PerformanceUserMarkLogLevel = 1;\r\n    /**\r\n     * Log performance to the console\r\n     */\r\n    Tools.PerformanceConsoleLogLevel = 2;\r\n    /**\r\n     * Starts a performance counter\r\n     */\r\n    Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\r\n    /**\r\n     * Ends a specific performance coutner\r\n     */\r\n    Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\r\n    return Tools;\r\n}());\r\nexport { Tools };\r\n/**\r\n * Use this className as a decorator on a given class definition to add it a name and optionally its module.\r\n * You can then use the Tools.getClassName(obj) on an instance to retrieve its class name.\r\n * This method is the only way to get it done in all cases, even if the .js file declaring the class is minified\r\n * @param name The name of the class, case should be preserved\r\n * @param module The name of the Module hosting the class, optional, but strongly recommended to specify if possible. Case should be preserved.\r\n */\r\nexport function className(name, module) {\r\n    return function (target) {\r\n        target[\"__bjsclassName__\"] = name;\r\n        target[\"__bjsmoduleName__\"] = module != null ? module : null;\r\n    };\r\n}\r\n/**\r\n * An implementation of a loop for asynchronous functions.\r\n */\r\nvar AsyncLoop = /** @class */ (function () {\r\n    /**\r\n     * Constructor.\r\n     * @param iterations the number of iterations.\r\n     * @param func the function to run each iteration\r\n     * @param successCallback the callback that will be called upon succesful execution\r\n     * @param offset starting offset.\r\n     */\r\n    function AsyncLoop(\r\n    /**\r\n     * Defines the number of iterations for the loop\r\n     */\r\n    iterations, func, successCallback, offset) {\r\n        if (offset === void 0) { offset = 0; }\r\n        this.iterations = iterations;\r\n        this.index = offset - 1;\r\n        this._done = false;\r\n        this._fn = func;\r\n        this._successCallback = successCallback;\r\n    }\r\n    /**\r\n     * Execute the next iteration. Must be called after the last iteration was finished.\r\n     */\r\n    AsyncLoop.prototype.executeNext = function () {\r\n        if (!this._done) {\r\n            if (this.index + 1 < this.iterations) {\r\n                ++this.index;\r\n                this._fn(this);\r\n            }\r\n            else {\r\n                this.breakLoop();\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Break the loop and run the success callback.\r\n     */\r\n    AsyncLoop.prototype.breakLoop = function () {\r\n        this._done = true;\r\n        this._successCallback();\r\n    };\r\n    /**\r\n     * Create and run an async loop.\r\n     * @param iterations the number of iterations.\r\n     * @param fn the function to run each iteration\r\n     * @param successCallback the callback that will be called upon succesful execution\r\n     * @param offset starting offset.\r\n     * @returns the created async loop object\r\n     */\r\n    AsyncLoop.Run = function (iterations, fn, successCallback, offset) {\r\n        if (offset === void 0) { offset = 0; }\r\n        var loop = new AsyncLoop(iterations, fn, successCallback, offset);\r\n        loop.executeNext();\r\n        return loop;\r\n    };\r\n    /**\r\n     * A for-loop that will run a given number of iterations synchronous and the rest async.\r\n     * @param iterations total number of iterations\r\n     * @param syncedIterations number of synchronous iterations in each async iteration.\r\n     * @param fn the function to call each iteration.\r\n     * @param callback a success call back that will be called when iterating stops.\r\n     * @param breakFunction a break condition (optional)\r\n     * @param timeout timeout settings for the setTimeout function. default - 0.\r\n     * @returns the created async loop object\r\n     */\r\n    AsyncLoop.SyncAsyncForLoop = function (iterations, syncedIterations, fn, callback, breakFunction, timeout) {\r\n        if (timeout === void 0) { timeout = 0; }\r\n        return AsyncLoop.Run(Math.ceil(iterations / syncedIterations), function (loop) {\r\n            if (breakFunction && breakFunction()) {\r\n                loop.breakLoop();\r\n            }\r\n            else {\r\n                setTimeout(function () {\r\n                    for (var i = 0; i < syncedIterations; ++i) {\r\n                        var iteration = loop.index * syncedIterations + i;\r\n                        if (iteration >= iterations) {\r\n                            break;\r\n                        }\r\n                        fn(iteration);\r\n                        if (breakFunction && breakFunction()) {\r\n                            loop.breakLoop();\r\n                            break;\r\n                        }\r\n                    }\r\n                    loop.executeNext();\r\n                }, timeout);\r\n            }\r\n        }, callback);\r\n    };\r\n    return AsyncLoop;\r\n}());\r\nexport { AsyncLoop };\r\n// Will only be define if Tools is imported freeing up some space when only engine is required\r\nEngineStore.FallbackTexture =\r\n    \"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z\";\r\n// Register promise fallback for IE\r\nPromisePolyfill.Apply();\r\n"]},"metadata":{},"sourceType":"module"}